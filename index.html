<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>REDIR.SPLIT â€” Link Randomizer</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600&family=Bebas+Neue&display=swap');

  :root {
    --bg: #07070f;
    --surface: #0d0d1a;
    --surface2: #111120;
    --border: #1c1c2e;
    --border2: #252538;
    --text: #d8d8ec;
    --muted: #555570;
    --amber: #f59e0b;
    --cyan: #06b6d4;
    --green: #10b981;
    --red: #f43f5e;
    --purple: #8b5cf6;
    --pink: #ec4899;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }
  body { background: var(--bg); color: var(--text); font-family: 'IBM Plex Mono', monospace; min-height: 100vh; }

  ::-webkit-scrollbar { width: 5px; height: 5px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }

  /* â”€â”€ Base components â”€â”€ */
  .inp {
    background: #09091a; border: 1px solid var(--border); border-radius: 7px;
    color: var(--text); padding: 9px 13px; font-family: inherit; font-size: 13px;
    outline: none; transition: border .15s, box-shadow .15s; width: 100%;
  }
  .inp:focus { border-color: var(--amber); box-shadow: 0 0 0 3px #f59e0b18; }
  .inp::placeholder { color: #2e2e48; }

  .btn {
    border: none; cursor: pointer; border-radius: 7px; font-family: inherit;
    transition: all .15s; font-size: 12px; font-weight: 500; letter-spacing: .05em;
    display: inline-flex; align-items: center; gap: 6px; white-space: nowrap;
  }
  .btn-amber { background: var(--amber); color: #07070f; padding: 9px 20px; }
  .btn-amber:hover { background: #fbbf24; transform: translateY(-1px); box-shadow: 0 4px 20px #f59e0b33; }
  .btn-amber:active { transform: translateY(0); }
  .btn-ghost { background: transparent; color: var(--muted); padding: 8px 14px; border: 1px solid var(--border); }
  .btn-ghost:hover { background: var(--surface2); color: var(--text); border-color: var(--border2); }
  .btn-red { background: transparent; color: var(--red); padding: 7px 12px; border: 1px solid #3a1525; font-size: 11px; }
  .btn-red:hover { background: #1a0810; }
  .btn-green { background: transparent; color: var(--green); padding: 7px 14px; border: 1px solid #0a3320; font-size: 11px; }
  .btn-green:hover { background: #03150c; }
  .btn-sm { padding: 5px 10px; font-size: 11px; }

  .card {
    background: var(--surface); border: 1px solid var(--border); border-radius: 11px;
    transition: border-color .2s;
  }
  .card:hover { border-color: var(--border2); }

  .pill {
    display: inline-flex; align-items: center; gap: 4px;
    padding: 3px 10px; border-radius: 20px; font-size: 10px; letter-spacing: .07em; font-weight: 600;
  }
  .pill-amber { background: #1f1400; color: var(--amber); border: 1px solid #3a2800; }
  .pill-cyan  { background: #001820; color: var(--cyan);  border: 1px solid #003040; }
  .pill-green { background: #001a0e; color: var(--green); border: 1px solid #003520; }
  .pill-red   { background: #1a0008; color: var(--red);   border: 1px solid #380018; }
  .pill-purple{ background: #100a20; color: var(--purple);border: 1px solid #2a1548; }

  /* â”€â”€ Layout â”€â”€ */
  header {
    border-bottom: 1px solid var(--border); padding: 15px 28px;
    display: flex; align-items: center; justify-content: space-between;
    position: sticky; top: 0; background: rgba(7,7,15,.95); backdrop-filter: blur(12px); z-index: 100;
  }
  .logo { font-family: 'Bebas Neue', sans-serif; font-size: 26px; letter-spacing: .12em; }
  .logo span { color: var(--amber); }

  main { max-width: 980px; margin: 0 auto; padding: 32px 20px 80px; }

  /* â”€â”€ Tabs â”€â”€ */
  .tabs { display: flex; gap: 4px; margin-bottom: 28px; background: var(--surface); padding: 4px; border-radius: 10px; border: 1px solid var(--border); width: fit-content; }
  .tab { padding: 7px 18px; border-radius: 7px; font-size: 12px; letter-spacing: .05em; cursor: pointer; border: none; background: transparent; color: var(--muted); font-family: inherit; font-weight: 500; transition: all .15s; }
  .tab.active { background: var(--amber); color: #07070f; }
  .tab:hover:not(.active) { color: var(--text); }

  /* â”€â”€ Stats grid â”€â”€ */
  .kpi-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 12px; margin-bottom: 24px; }
  @media(max-width:700px){ .kpi-grid { grid-template-columns: repeat(2,1fr); } }

  .kpi { padding: 16px 18px; }
  .kpi-label { font-size: 10px; color: var(--muted); letter-spacing: .1em; margin-bottom: 8px; }
  .kpi-value { font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: .04em; }

  /* â”€â”€ Link row â”€â”€ */
  .link-row { display: grid; grid-template-columns: 1fr 1.6fr auto; gap: 10px; align-items: start; margin-bottom: 12px; }
  @media(max-width:600px){ .link-row { grid-template-columns: 1fr; } }

  /* â”€â”€ Slider â”€â”€ */
  .slider { -webkit-appearance: none; height: 4px; background: var(--border2); border-radius: 3px; outline: none; cursor: pointer; width: 100%; }
  .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: var(--amber); border-radius: 50%; cursor: pointer; box-shadow: 0 0 0 3px var(--bg), 0 0 0 5px #f59e0b44; transition: transform .1s; }
  .slider::-webkit-slider-thumb:hover { transform: scale(1.2); }

  /* â”€â”€ Progress â”€â”€ */
  .bar-track { height: 5px; background: var(--border); border-radius: 3px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 3px; transition: width .5s ease; }

  /* â”€â”€ Modal â”€â”€ */
  .overlay { position: fixed; inset: 0; background: rgba(0,0,0,.8); z-index: 200; display: flex; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px); }
  .modal { width: 460px; max-width: 100%; padding: 28px; }
  .modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: .1em; color: var(--amber); margin-bottom: 18px; }

  /* â”€â”€ Toast â”€â”€ */
  #toast {
    position: fixed; bottom: 28px; left: 50%; transform: translateX(-50%) translateY(20px);
    padding: 11px 22px; border-radius: 8px; font-size: 12px; font-weight: 500; letter-spacing: .04em;
    z-index: 999; opacity: 0; transition: all .3s; pointer-events: none; white-space: nowrap;
  }
  #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
  #toast.ok  { background: #001a0e; color: var(--green); border: 1px solid #004020; }
  #toast.err { background: #1a0008; color: var(--red);   border: 1px solid #380018; }

  /* â”€â”€ Donut â”€â”€ */
  .donut-wrap { display: flex; gap: 24px; align-items: center; flex-wrap: wrap; }
  .donut-legend { display: flex; flex-direction: column; gap: 8px; }
  .legend-row { display: flex; align-items: center; gap: 8px; font-size: 12px; }
  .legend-dot { width: 10px; height: 10px; border-radius: 3px; flex-shrink: 0; }

  /* â”€â”€ Redirect preview â”€â”€ */
  .redir-result { margin-top: 14px; padding: 14px 18px; background: #001a0e; border: 1px solid #003a20; border-radius: 8px; }
  .redir-result-label { font-size: 10px; color: #2d6e3e; letter-spacing: .1em; margin-bottom: 5px; }
  .redir-result-name { color: var(--green); font-weight: 600; font-size: 14px; margin-bottom: 4px; }
  .redir-result-url { color: #1d5e2e; font-size: 11px; word-break: break-all; }

  /* â”€â”€ Animations â”€â”€ */
  @keyframes fadeUp   { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }
  @keyframes fadeIn   { from { opacity:0; } to { opacity:1; } }
  @keyframes spin     { to { transform: rotate(360deg); } }
  .fade-up  { animation: fadeUp .28s ease forwards; }
  .fade-in  { animation: fadeIn .2s ease forwards; }

  /* â”€â”€ Empty state â”€â”€ */
  .empty { text-align: center; padding: 70px 0; color: var(--border2); }
  .empty-icon { font-family: 'Bebas Neue', sans-serif; font-size: 72px; letter-spacing: .1em; color: var(--surface2); }
  .empty-sub { font-size: 13px; color: #2a2a3a; margin-top: 10px; }

  /* â”€â”€ Unique link box â”€â”€ */
  .link-box { display: flex; gap: 10px; align-items: center; background: #09091a; border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; }
  .link-code { flex: 1; font-size: 12px; color: var(--amber); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

  /* â”€â”€ Textarea â”€â”€ */
  textarea.inp { resize: vertical; min-height: 160px; font-size: 11px; }

  /* â”€â”€ Section header â”€â”€ */
  .sec-title { font-size: 10px; color: var(--muted); letter-spacing: .12em; margin-bottom: 12px; }

  /* â”€â”€ Group card in list â”€â”€ */
  .group-card { padding: 20px 22px; cursor: default; }
  .group-name { font-family: 'Bebas Neue', sans-serif; font-size: 19px; letter-spacing: .07em; color: #eee; }

  /* â”€â”€ Inline edit for group title â”€â”€ */
  .title-inp { font-family: 'Bebas Neue', sans-serif; font-size: 24px; background: transparent; border: none; border-bottom: 1px solid var(--border); border-radius: 0; padding: 6px 0; letter-spacing: .07em; color: var(--amber); }

  /* â”€â”€ Conversion badge â”€â”€ */
  .conv-badge { display: inline-flex; align-items: center; gap: 4px; font-size: 11px; color: var(--green); }
</style>
</head>
<body>

<!-- TOAST -->
<div id="toast"></div>

<!-- MODAL container -->
<div id="modal-wrap"></div>

<!-- HEADER -->
<header>
  <div style="display:flex;align-items:center;gap:14px">
    <div id="btn-back" class="btn btn-ghost btn-sm" style="display:none" onclick="goBack()">â† VOLTAR</div>
    <div class="logo"><span>REDIR</span>.SPLIT</div>
  </div>
  <div style="display:flex;gap:8px;align-items:center">
    <input type="file" id="file-inp" accept=".json" style="display:none" onchange="handleFileImport(event)">
    <button class="btn btn-ghost btn-sm" onclick="document.getElementById('file-inp').click()">â†‘ IMPORTAR</button>
    <button class="btn btn-ghost btn-sm" onclick="exportGroups()">â†“ EXPORTAR</button>
    <button id="btn-new-group" class="btn btn-amber btn-sm" onclick="showCreateModal()">+ NOVO GRUPO</button>
  </div>
</header>

<main id="main"></main>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA LAYER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STORAGE_KEY = 'rdrsplit_v3';

const SEED = [{
  id: 'seed1',
  name: 'Teste A/B â€” Landing Page',
  description: 'Comparando duas versÃµes da homepage',
  links: [
    { id:'la', label:'VersÃ£o A â€” Hero VÃ­deo',  url:'https://example.com/versao-a', weight:70, clicks:142, conversions:28 },
    { id:'lb', label:'VersÃ£o B â€” Hero Imagem', url:'https://example.com/versao-b', weight:30, clicks:61,  conversions:15 },
  ],
  createdAt: Date.now() - 864e5,
  totalClicks: 203,
}];

const PALETTE = ['#f59e0b','#06b6d4','#10b981','#f43f5e','#8b5cf6','#ec4899','#fb923c','#a3e635'];

let groups = [];
let page = 'home'; // home | edit | stats
let activeId = null;
let simResult = null;

function loadGroups() {
  try {
    const s = localStorage.getItem(STORAGE_KEY);
    groups = s ? JSON.parse(s) : SEED;
  } catch { groups = SEED; }
}
function saveGroups() {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(groups)); } catch {}
}
function uid() { return Math.random().toString(36).substr(2,9); }
function shortCode(id) { return btoa(id).replace(/[^a-z0-9]/gi,'').substr(0,8); }

// â”€â”€ mutations
function mutateGroup(id, fn) {
  groups = groups.map(g => g.id === id ? fn({...g}) : g);
  saveGroups();
}
function mutateLink(gid, lid, fn) {
  mutateGroup(gid, g => ({ ...g, links: g.links.map(l => l.id === lid ? fn({...l}) : l) }));
}

// â”€â”€ weighted pick
function pickLink(links) {
  if (!links.length) return null;
  const total = links.reduce((s,l) => s + l.weight, 0);
  let r = Math.random() * total;
  for (const l of links) { r -= l.weight; if (r <= 0) return l; }
  return links[links.length - 1];
}

// â”€â”€ number helpers
function fmtNum(n) { return n >= 1000 ? (n/1000).toFixed(1)+'k' : String(n); }
function pct(n, d) { return d ? ((n/d)*100).toFixed(1)+'%' : '0.0%'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTimer;
function toast(msg, ok=true) {
  const el = document.getElementById('toast');
  el.textContent = (ok ? 'âœ“ ' : 'âœ• ') + msg;
  el.className = 'show ' + (ok ? 'ok' : 'err');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => { el.className = ''; }, 2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showModal(html, onClose) {
  const wrap = document.getElementById('modal-wrap');
  wrap.innerHTML = `
    <div class="overlay fade-in" onclick="if(event.target===this)closeModal()">
      <div class="card modal fade-up">${html}</div>
    </div>`;
  wrap._onClose = onClose;
}
function closeModal() {
  const wrap = document.getElementById('modal-wrap');
  if (wrap._onClose) wrap._onClose();
  wrap.innerHTML = '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goBack() {
  page = 'home'; activeId = null; simResult = null; render();
}
function openEdit(id) {
  activeId = id; page = 'edit'; simResult = null; render();
}
function openStats(id) {
  activeId = id; page = 'stats'; simResult = null; render();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORT / IMPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportGroups() {
  const blob = new Blob([JSON.stringify(groups, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'redir-split-grupos.json'; a.click();
  URL.revokeObjectURL(url);
  toast('Exportado com sucesso!');
}
function handleFileImport(e) {
  const file = e.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => showImportModal(ev.target.result);
  reader.readAsText(file);
  e.target.value = '';
}
function showImportModal(content) {
  showModal(`
    <div class="modal-title">IMPORTAR JSON</div>
    <textarea class="inp" id="import-ta" rows="10">${escH(content)}</textarea>
    <div style="display:flex;gap:10px;margin-top:14px">
      <button class="btn btn-amber" style="flex:1" onclick="doImport()">IMPORTAR</button>
      <button class="btn btn-ghost" onclick="closeModal()">CANCELAR</button>
    </div>
  `);
}
function doImport() {
  try {
    const val = document.getElementById('import-ta').value;
    const parsed = JSON.parse(val);
    if (!Array.isArray(parsed)) throw new Error();
    groups = parsed; saveGroups(); closeModal(); render(); toast('Importado com sucesso!');
  } catch { toast('JSON invÃ¡lido', false); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CREATE GROUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showCreateModal() {
  showModal(`
    <div class="modal-title">NOVO GRUPO</div>
    <div style="display:flex;flex-direction:column;gap:10px">
      <input class="inp" id="new-name" placeholder="Nome do grupo (ex: A/B Checkout)" autofocus
        onkeydown="if(event.key==='Enter')doCreateGroup()">
      <input class="inp" id="new-desc" placeholder="DescriÃ§Ã£o opcional"
        onkeydown="if(event.key==='Enter')doCreateGroup()">
    </div>
    <div style="display:flex;gap:10px;margin-top:16px">
      <button class="btn btn-amber" style="flex:1" onclick="doCreateGroup()">CRIAR GRUPO</button>
      <button class="btn btn-ghost" onclick="closeModal()">CANCELAR</button>
    </div>
  `, null);
  setTimeout(() => document.getElementById('new-name')?.focus(), 50);
}
function doCreateGroup() {
  const name = document.getElementById('new-name')?.value?.trim();
  const desc = document.getElementById('new-desc')?.value?.trim();
  if (!name) { toast('Digite um nome', false); return; }
  const g = { id: uid(), name, description: desc||'', links: [], createdAt: Date.now(), totalClicks: 0 };
  groups.unshift(g); saveGroups();
  closeModal(); openEdit(g.id);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LINK OPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addLink(gid) {
  mutateGroup(gid, g => ({
    ...g, links: [...g.links, { id:uid(), label:'', url:'', weight:50, clicks:0, conversions:0 }]
  }));
  render();
}
function deleteLink(gid, lid) {
  mutateGroup(gid, g => ({ ...g, links: g.links.filter(l => l.id !== lid) }));
  render();
}
function deleteGroup(id) {
  groups = groups.filter(g => g.id !== id);
  saveGroups();
  if (activeId === id) { page='home'; activeId=null; }
  render(); toast('Grupo removido');
}

// â”€â”€ field updates (called on blur/input via inline handlers)
function updateGroupField(id, field, val) {
  mutateGroup(id, g => ({ ...g, [field]: val }));
}
function updateLinkField(gid, lid, field, val) {
  mutateLink(gid, lid, l => ({ ...l, [field]: field==='weight' ? +val : val }));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMULATE REDIRECT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simulate(gid) {
  const g = groups.find(x => x.id === gid);
  if (!g || !g.links.length) return;
  const chosen = pickLink(g.links);
  if (!chosen) return;
  simResult = { gid, link: chosen };
  mutateLink(gid, chosen.id, l => ({ ...l, clicks: l.clicks + 1 }));
  mutateGroup(gid, g2 => ({ ...g2, totalClicks: g2.totalClicks + 1 }));
  render();

  // Scroll to result
  setTimeout(() => document.getElementById('sim-result')?.scrollIntoView({ behavior:'smooth', block:'nearest' }), 100);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADD CONVERSION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addConversion(gid, lid) {
  mutateLink(gid, lid, l => ({ ...l, conversions: l.conversions + 1 }));
  render(); toast('+1 conversÃ£o registrada');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COPY LINK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function copyLink(id) {
  const url = `${location.origin}${location.pathname}?r=${shortCode(id)}`;
  navigator.clipboard?.writeText(url)
    .then(() => toast('Link copiado!'))
    .catch(() => { prompt('Copie o link:', url); });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REDIRECT HANDLER (runs on page load)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkRedirect() {
  const params = new URLSearchParams(location.search);
  const code = params.get('r');
  if (!code) return false;

  // Find group by short code
  const g = groups.find(x => shortCode(x.id) === code);
  if (!g || !g.links.length) {
    showRedirectError(code);
    return true;
  }

  const chosen = pickLink(g.links);
  if (!chosen || !chosen.url) {
    showRedirectError(code);
    return true;
  }

  // Track click
  mutateLink(g.id, chosen.id, l => ({ ...l, clicks: l.clicks + 1 }));
  mutateGroup(g.id, gr => ({ ...gr, totalClicks: gr.totalClicks + 1 }));

  // Show redirect screen briefly then go
  document.body.innerHTML = `
    <div style="display:flex;align-items:center;justify-content:center;min-height:100vh;flex-direction:column;gap:20px;background:#07070f;color:#d8d8ec;font-family:'IBM Plex Mono',monospace">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:32px;letter-spacing:.1em;color:#f59e0b">REDIR.SPLIT</div>
      <div style="font-size:13px;color:#555">Redirecionando para <strong style="color:#10b981">${escH(chosen.label || chosen.url)}</strong></div>
      <div style="font-size:11px;color:#333">${escH(chosen.url)}</div>
      <div style="width:200px;height:3px;background:#1c1c2e;border-radius:2px;overflow:hidden;margin-top:10px">
        <div id="prog" style="height:100%;background:#f59e0b;border-radius:2px;width:0;transition:width 1.5s linear"></div>
      </div>
    </div>`;
  setTimeout(() => { document.getElementById('prog').style.width = '100%'; }, 50);
  setTimeout(() => { window.location.href = chosen.url; }, 1600);
  return true;
}

function showRedirectError(code) {
  document.body.innerHTML = `
    <div style="display:flex;align-items:center;justify-content:center;min-height:100vh;flex-direction:column;gap:16px;background:#07070f;color:#d8d8ec;font-family:'IBM Plex Mono',monospace">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:32px;color:#f43f5e">LINK NÃƒO ENCONTRADO</div>
      <div style="font-size:13px;color:#555">O cÃ³digo <code style="color:#f59e0b">${escH(code)}</code> nÃ£o existe ou nÃ£o tem links</div>
      <a href="${location.pathname}" style="color:#f59e0b;font-size:13px;margin-top:10px">â† Voltar ao inÃ­cio</a>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DONUT CHART (SVG)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildDonut(segments) {
  const r = 46, cx = 60, cy = 60, circ = 2*Math.PI*r;
  const total = segments.reduce((s,g) => s+g.value, 0);
  let offset = 0, slicesHTML = '';
  segments.forEach(seg => {
    const dash = total ? (seg.value/total)*circ : 0;
    slicesHTML += `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="${seg.color}"
      stroke-width="18" stroke-dasharray="${dash} ${circ-dash}"
      stroke-dashoffset="${-offset}" stroke-linecap="butt"/>`;
    offset += dash;
  });
  return `<svg width="120" height="120" viewBox="0 0 120 120" style="transform:rotate(-90deg)">
    <circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="#1e1e2a" stroke-width="18"/>
    ${slicesHTML}
  </svg>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HTML ESCAPE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function escH(s) {
  return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render() {
  const main = document.getElementById('main');
  const btnBack = document.getElementById('btn-back');
  const btnNew = document.getElementById('btn-new-group');

  btnBack.style.display = page !== 'home' ? 'inline-flex' : 'none';
  btnNew.style.display  = page === 'home' ? 'inline-flex' : 'none';

  if (page === 'home')  { main.innerHTML = renderHome(); }
  if (page === 'edit')  { main.innerHTML = renderEdit(); }
  if (page === 'stats') { main.innerHTML = renderStats(); }

  // Bind sliders after render
  document.querySelectorAll('.weight-slider').forEach(sl => {
    sl.addEventListener('input', e => {
      const { gid, lid } = e.target.dataset;
      const val = +e.target.value;
      mutateLink(gid, lid, l => ({ ...l, weight: val }));
      // Update label next to slider without full re-render
      const span = document.getElementById(`wlabel-${lid}`);
      if (span) {
        const g = groups.find(x => x.id === gid);
        const totalW = g ? g.links.reduce((s,l2)=>s+l2.weight,0) : 1;
        span.textContent = `${val} (${Math.round(val/totalW*100)}%)`;
      }
    });
  });

  // Bind text inputs
  document.querySelectorAll('.link-inp').forEach(inp => {
    inp.addEventListener('change', e => {
      const { gid, lid, field } = e.target.dataset;
      updateLinkField(gid, lid, field, e.target.value);
    });
  });
  document.querySelectorAll('.group-field').forEach(inp => {
    inp.addEventListener('change', e => {
      const { gid, field } = e.target.dataset;
      updateGroupField(gid, field, e.target.value);
    });
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HOME VIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderHome() {
  const totalClicks = groups.reduce((s,g)=>s+g.totalClicks,0);
  const totalConv   = groups.reduce((s,g)=>s+g.links.reduce((a,l)=>a+l.conversions,0),0);

  let summary = '';
  if (groups.length > 0) {
    summary = `
      <div class="kpi-grid" style="grid-template-columns:repeat(3,1fr);margin-bottom:28px">
        ${kpiCard('GRUPOS', groups.length, '#f59e0b')}
        ${kpiCard('TOTAL CLIQUES', fmtNum(totalClicks), '#06b6d4')}
        ${kpiCard('CONVERSÃ•ES', fmtNum(totalConv)+' ('+pct(totalConv,totalClicks)+')', '#10b981')}
      </div>`;
  }

  if (groups.length === 0) {
    return `${summary}
      <div class="empty fade-up">
        <div class="empty-icon">VAZIO</div>
        <div class="empty-sub">Crie um grupo para comeÃ§ar a distribuir trÃ¡fego</div>
        <button class="btn btn-amber" style="margin-top:20px" onclick="showCreateModal()">+ CRIAR PRIMEIRO GRUPO</button>
      </div>`;
  }

  const cards = groups.map((g, gi) => {
    const totalW   = g.links.reduce((s,l)=>s+l.weight,0);
    const totalConvG = g.links.reduce((s,l)=>s+l.conversions,0);
    const bars = g.links.map((l,i) => {
      const w = totalW ? l.weight/totalW*100 : 100/g.links.length;
      const c = PALETTE[i%PALETTE.length];
      return `<div style="display:flex;align-items:center;gap:10px">
        <div style="font-size:11px;color:#555;width:130px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${escH(l.label||l.url||'â€”')}</div>
        <div class="bar-track" style="flex:1"><div class="bar-fill" style="width:${w.toFixed(1)}%;background:${c}"></div></div>
        <div style="font-size:11px;color:${c};width:34px;text-align:right">${Math.round(w)}%</div>
      </div>`;
    }).join('');

    return `
      <div class="card group-card fade-up" style="animation-delay:${gi*.04}s">
        <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:16px">
          <div style="flex:1;min-width:0">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:5px;flex-wrap:wrap">
              <span class="group-name">${escH(g.name)}</span>
              ${g.description ? `<span style="font-size:11px;color:#444">${escH(g.description)}</span>` : ''}
            </div>
            <div style="display:flex;gap:18px;font-size:11px;color:#444;margin-bottom:${g.links.length?'14px':'0'}">
              <span>${g.links.length} links</span>
              <span>${fmtNum(g.totalClicks)} cliques</span>
              <span style="color:#10b981">${pct(totalConvG, g.totalClicks)} conv.</span>
            </div>
            ${g.links.length ? `<div style="display:flex;flex-direction:column;gap:5px">${bars}</div>` : ''}
          </div>
          <div style="display:flex;gap:8px;flex-shrink:0">
            <button class="btn btn-ghost btn-sm" onclick="openStats('${g.id}')">STATS</button>
            <button class="btn btn-ghost btn-sm" onclick="openEdit('${g.id}')">EDITAR</button>
            <button class="btn btn-red btn-sm" onclick="if(confirm('Remover grupo?'))deleteGroup('${g.id}')">âœ•</button>
          </div>
        </div>
      </div>`;
  }).join('');

  return summary + `<div style="display:flex;flex-direction:column;gap:12px">${cards}</div>`;
}

function kpiCard(label, value, color) {
  return `<div class="card kpi"><div class="kpi-label">${label}</div><div class="kpi-value" style="color:${color}">${value}</div></div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EDIT VIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderEdit() {
  const g = groups.find(x => x.id === activeId);
  if (!g) return '<div>Grupo nÃ£o encontrado</div>';

  const linkRows = g.links.map((l, i) => {
    const color = PALETTE[i%PALETTE.length];
    const totalW = g.links.reduce((s,x)=>s+x.weight,0);
    const wpct = totalW ? Math.round(l.weight/totalW*100) : 0;
    return `
      <div class="card" style="padding:16px 18px;border-left:3px solid ${color};margin-bottom:10px">
        <div class="link-row" style="margin-bottom:12px">
          <input class="inp link-inp" placeholder="Label (ex: VersÃ£o A)"
            value="${escH(l.label)}" data-gid="${g.id}" data-lid="${l.id}" data-field="label">
          <input class="inp link-inp" placeholder="URL destino (https://...)"
            value="${escH(l.url)}" data-gid="${g.id}" data-lid="${l.id}" data-field="url">
          <button class="btn btn-red" onclick="if(confirm('Remover link?'))deleteLink('${g.id}','${l.id}')">REMOVER</button>
        </div>
        <div style="display:flex;align-items:center;gap:12px">
          <span style="font-size:11px;color:#444;white-space:nowrap">Peso:</span>
          <input type="range" class="slider weight-slider" min="1" max="100" value="${l.weight}"
            data-gid="${g.id}" data-lid="${l.id}" style="flex:1;accent-color:${color}">
          <span id="wlabel-${l.id}" style="font-size:12px;color:${color};width:72px;text-align:right;white-space:nowrap">
            ${l.weight} (${wpct}%)
          </span>
        </div>
      </div>`;
  }).join('');

  const myLink = `${location.origin}${location.pathname}?r=${shortCode(g.id)}`;

  return `
    <div class="fade-up">
      <div style="margin-bottom:6px">
        <input class="inp title-inp group-field" value="${escH(g.name)}" data-gid="${g.id}" data-field="name">
      </div>
      <input class="inp group-field" value="${escH(g.description||'')}" placeholder="DescriÃ§Ã£o opcional"
        data-gid="${g.id}" data-field="description" style="margin-bottom:28px;font-size:12px;color:#555">

      <div class="card" style="padding:16px 20px;margin-bottom:24px;border-color:#1e1e10">
        <div class="sec-title">ğŸ”— SEU LINK ÃšNICO (FUNCIONANDO)</div>
        <div class="link-box">
          <span class="link-code">${escH(myLink)}</span>
          <button class="btn btn-ghost btn-sm" onclick="copyLink('${g.id}')">COPIAR</button>
          <a href="${escH(myLink)}" target="_blank" class="btn btn-ghost btn-sm" style="text-decoration:none">TESTAR â†—</a>
        </div>
        <div style="font-size:11px;color:#2a2a44;margin-top:8px">
          Abra esse link para ser redirecionado de acordo com os pesos definidos abaixo.
        </div>
      </div>

      <div class="sec-title">LINKS E PESOS</div>
      ${linkRows || '<div style="font-size:12px;color:#333;padding:16px 0">Nenhum link. Adicione abaixo.</div>'}

      <button class="btn btn-ghost" style="width:100%;padding:14px;font-size:12px;margin-top:4px"
        onclick="addLink('${g.id}')">+ ADICIONAR LINK</button>

      <div style="margin-top:22px;display:flex;gap:10px">
        <button class="btn btn-amber" onclick="openStats('${g.id}')">VER ESTATÃSTICAS â†’</button>
      </div>
    </div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATS VIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStats() {
  const g = groups.find(x => x.id === activeId);
  if (!g) return '<div>Grupo nÃ£o encontrado</div>';

  const totalConv = g.links.reduce((s,l)=>s+l.conversions,0);
  const bestCVR   = g.links.reduce((best,l) => {
    const r = l.clicks ? l.conversions/l.clicks : 0;
    return r > best ? r : best;
  }, 0);

  const myLink = `${location.origin}${location.pathname}?r=${shortCode(g.id)}`;

  // KPIs
  const kpis = `
    <div class="kpi-grid" style="margin-bottom:24px">
      ${kpiCard('TOTAL CLIQUES',   fmtNum(g.totalClicks),                        '#06b6d4')}
      ${kpiCard('CONVERSÃ•ES',      fmtNum(totalConv),                            '#10b981')}
      ${kpiCard('TAXA CONV.',      pct(totalConv, g.totalClicks),                '#f59e0b')}
      ${kpiCard('MELHOR CVR',      (bestCVR*100).toFixed(1)+'%',                 '#8b5cf6')}
    </div>`;

  // Simulator result
  let simHTML = '';
  if (simResult && simResult.gid === g.id) {
    const l = simResult.link;
    simHTML = `<div id="sim-result" class="redir-result fade-up">
      <div class="redir-result-label">â†’ REDIRECIONARIA PARA:</div>
      <div class="redir-result-name">${escH(l.label||'â€”')}</div>
      <div class="redir-result-url">${escH(l.url)}</div>
    </div>`;
  }

  // Per-link cards
  const linkCards = g.links.map((l, i) => {
    const color  = PALETTE[i%PALETTE.length];
    const totalW = g.links.reduce((s,x)=>s+x.weight,0);
    const tgt    = totalW ? l.weight/totalW*100 : 0;
    const real   = g.totalClicks ? l.clicks/g.totalClicks*100 : 0;
    const cvr    = l.clicks ? l.conversions/l.clicks*100 : 0;

    const bars3 = [
      {label:'TrÃ¡fego alvo',   val:tgt,  bg:'#f59e0b22', fill:'#f59e0b'},
      {label:'TrÃ¡fego real',   val:real, bg:'#06b6d422', fill:'#06b6d4'},
      {label:'Taxa conversÃ£o', val:cvr,  bg:'#10b98122', fill:'#10b981'},
    ].map(b => `
      <div style="display:flex;gap:10px;align-items:center">
        <div style="font-size:10px;color:#444;width:120px;flex-shrink:0">${b.label}</div>
        <div style="flex:1;height:5px;background:${b.bg};border-radius:3px">
          <div style="width:${Math.min(b.val,100).toFixed(1)}%;height:100%;background:${b.fill};border-radius:3px;transition:width .5s"></div>
        </div>
        <div style="font-size:11px;color:${b.fill};width:40px;text-align:right">${b.val.toFixed(1)}%</div>
      </div>`).join('');

    return `
      <div class="card" style="padding:18px 20px;margin-bottom:10px;border-left:3px solid ${color}">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;flex-wrap:wrap;gap:8px">
          <div>
            <div style="font-weight:600;font-size:14px;color:#eee;margin-bottom:3px">${escH(l.label||'â€”')}</div>
            <div style="font-size:11px;color:#444;word-break:break-all">${escH(l.url)}</div>
          </div>
          <div style="display:flex;gap:7px;flex-wrap:wrap">
            <span class="pill pill-amber">ALVO ${Math.round(tgt)}%</span>
            <span class="pill pill-cyan">REAL ${real.toFixed(1)}%</span>
            <span class="pill pill-green">CVR ${cvr.toFixed(1)}%</span>
          </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:14px">${bars3}</div>
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px">
          <div style="display:flex;gap:18px;font-size:12px;color:#444">
            <span>${fmtNum(l.clicks)} cliques</span>
            <span style="color:#10b981">${fmtNum(l.conversions)} conversÃµes</span>
          </div>
          <button class="btn btn-green btn-sm" onclick="addConversion('${g.id}','${l.id}')">
            + CONVERSÃƒO
          </button>
        </div>
      </div>`;
  }).join('');

  // Donut (only if there's data)
  let donutHTML = '';
  if (g.links.length > 1 && g.totalClicks > 0) {
    const segments = g.links.map((l,i) => ({ value:l.clicks, color:PALETTE[i%PALETTE.length] }));
    const legend   = g.links.map((l,i) => `
      <div class="legend-row">
        <div class="legend-dot" style="background:${PALETTE[i%PALETTE.length]}"></div>
        <div style="color:#666">${escH(l.label||'â€”')}</div>
        <div style="color:${PALETTE[i%PALETTE.length]}">${pct(l.clicks,g.totalClicks)}</div>
      </div>`).join('');

    donutHTML = `
      <div class="card" style="padding:20px 24px;margin-top:20px">
        <div class="sec-title">DISTRIBUIÃ‡ÃƒO REAL DE CLIQUES</div>
        <div class="donut-wrap">
          ${buildDonut(segments)}
          <div class="donut-legend">${legend}</div>
        </div>
      </div>`;
  }

  return `
    <div class="fade-up">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;flex-wrap:wrap;gap:10px">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:.08em;color:#f59e0b">${escH(g.name)}</div>
        <button class="btn btn-ghost btn-sm" onclick="openEdit('${g.id}')">EDITAR</button>
      </div>
      ${g.description ? `<div style="font-size:12px;color:#444;margin-bottom:20px">${escH(g.description)}</div>` : '<div style="margin-bottom:20px"></div>'}

      <!-- Link Ãºnico -->
      <div class="card" style="padding:14px 18px;margin-bottom:24px;border-color:#1e1e10">
        <div class="sec-title">ğŸ”— LINK ÃšNICO</div>
        <div class="link-box">
          <span class="link-code">${escH(myLink)}</span>
          <button class="btn btn-ghost btn-sm" onclick="copyLink('${g.id}')">COPIAR</button>
          <a href="${escH(myLink)}" target="_blank" class="btn btn-ghost btn-sm" style="text-decoration:none;color:var(--muted)">TESTAR â†—</a>
        </div>
      </div>

      ${kpis}

      <!-- Simulator -->
      <div class="card" style="padding:18px 22px;margin-bottom:24px">
        <div class="sec-title">SIMULADOR DE REDIRECT</div>
        ${g.links.length === 0
          ? '<div style="font-size:12px;color:#333">Adicione links ao grupo para simular.</div>'
          : `<button class="btn btn-amber" style="width:100%;padding:14px;font-size:13px;letter-spacing:.08em" onclick="simulate('${g.id}')">
               âŸ² SIMULAR REDIRECT
             </button>${simHTML}`
        }
      </div>

      <!-- Per-link stats -->
      ${g.links.length > 0 ? `
        <div class="sec-title">PERFORMANCE POR LINK</div>
        ${linkCards}
      ` : ''}

      ${donutHTML}

      <div style="margin-top:20px">
        <button class="btn btn-ghost btn-sm" onclick="openEdit('${g.id}')">EDITAR GRUPO</button>
      </div>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
loadGroups();
if (!checkRedirect()) {
  render();
}
</script>
</body>
</html>
